/*!
 * cfgallery - a light-weight, semantic gallery script with bookmarkable slides.
 *
 * Copyright (c) Crowd Favorite
 *
 * Uses:
 *
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */(function(a,b,c){function j(a){return a=a||location.href,"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}"$:nomunge";var d="hashchange",e=document,f,g=a.event.special,h=e.documentMode,i="on"+d in b&&(h===c||h>7);a.fn[d]=function(a){return a?this.bind(d,a):this.trigger(d)},a.fn[d].delay=50,g[d]=a.extend(g[d],{setup:function(){if(i)return!1;a(f.start)},teardown:function(){if(i)return!1;a(f.stop)}}),f=function(){function n(){var c=j(),e=m(h);c!==h?(l(h=c,e),a(b).trigger(d)):e!==h&&(location.href=location.href.replace(/#.*/,"")+e),g=setTimeout(n,a.fn[d].delay)}var f={},g,h=j(),k=function(a){return a},l=k,m=k;return f.start=function(){g||n()},f.stop=function(){g&&clearTimeout(g),g=c},a.browser.msie&&!i&&function(){var b,c;f.start=function(){b||(c=a.fn[d].src,c=c&&c+j(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){c||l(j()),n()}).attr("src",c||"javascript:0").insertAfter("body")[0].contentWindow,e.onpropertychange=function(){try{event.propertyName==="title"&&(b.document.title=e.title)}catch(a){}})},f.stop=k,m=function(){return j(b.location.href)},l=function(c,f){var g=b.document,h=a.fn[d].domain;c!==f&&(g.title=e.title,g.open(),h&&g.write('<script>document.domain="'+h+'"</script>'),g.close(),b.location.hash=c)}}(),f}()})(jQuery,this),function(a,b){var c=b.location,d=b.document.documentElement,e,f;e=function(c){var f=a.extend(e.opts,c),g=e.helpers,h=f.stageDimensions,i=f.bgColor,j;e.opts=f;if(this.length<1)return;g.$gal=this,g.$thumbs=this.find("ul a[href][id][data-largesrc]"),j=this.find(".gallery-stage"),j.length<1&&(j=a('<div class="gallery-stage" />'),this.prepend(j)),j.css({position:"relative",width:h[0],height:h[1],"background-color":i}),g.$loading=a('<div class="loading">Loading...</div>').hide().appendTo(j),g.$stage=j,g.$thumbs.click(function(b){g.setHashToken(a(this).attr("id")),b.preventDefault()}),j.click(function(a){g.setNextHashToken(),a.preventDefault()}),a(d).keyup(function(a){a.keyCode===39?g.setNextHashToken():a.keyCode===37&&g.setPrevHashToken()}),a(b).hashchange(function(a){var b=g.getHashToken();g.exhibit(b)}).ready(function(){g.patchHashToken()}).load(function(){var a=g.getHashToken();g.exhibit(a)}),g.$stage.bind("create.cfgal",function(a){g.$loading.show()}),g.$stage.bind("loaded.cfgal",function(a){g.$loading.hide()})},e.opts={stageDimensions:[710,474],start:0,activatedClass:"activated",figureClass:"gallery-figure",figcaptionClass:"figcaption",captionClass:"caption",titleClass:"title",bgColor:"#000"},e.helpers={current:null,exhibit:function(b){var c=this,d,f=a("#"+(b||this.getToken())),g=this.getThumbIndex(f),h;h=function(a){var b=e.opts.activatedClass,c=this.current,d;c!==null&&c!==g&&(d=this.getImage(c),this.$stage.children().not(d).hide(),this.$stage.find("img").stop(!0,!0),this.transitionSlides(a,d)),c===null&&this.transitionSlides(a),this.$thumbs.removeClass(b),f.addClass(b),this.preloadNeighbors(g),this.current=g},d=this.getImage(g),typeof d=="undefined"?(d=this.createImage(g),d.bind("loaded.cfgal",function(b){h.apply(c,[a(b.currentTarget)])})):h.apply(c,[d])},transitionSlides:function(a,b){b!==null&&typeof b!="undefined"?b.fadeOut("fast",function(){a.fadeIn("medium")}):a.fadeIn("medium")},getHashToken:function(a){return l=a||c.hash,l?l.slice(2):""},setHashToken:function(a){c.hash=this.makeHashToken(a)},makeHashToken:function(a){return"#/"+a},patchHashToken:function(){var a=c.hash;a.indexOf("#/")===-1&&this.$thumbs.filter(a).length>0&&(c.hash=this.makeHashToken(a.replace("#","")))},setNextHashToken:function(){var a,b=this.$thumbs.length-1,c;this.current<b?a=this.current+1:a=0,c=this.getToken(a),this.setHashToken(c)},setPrevHashToken:function(){var a,b=this.$thumbs.length-1,c;this.current>0?a=this.current-1:a=b,c=this.getToken(a),this.setHashToken(c)},getThumbIndex:function(a){return this.$thumbs.index(a)},getToken:function(a){var b=a||e.opts.start;return this.$thumbs.eq(b).attr("id")},getImage:function(a){return this.$thumbs.eq(a).data("cfgalExpanded")},getImageData:function(a){var b=a.find("img"),c=b.attr("title"),d=b.attr("alt");return c===d&&(c=""),{src:a.data("largesrc"),title:c,caption:d}},createImage:function(b){var c,d,f,g,h,i=e.opts,j=this.$thumbs.eq(b),k=this.$stage,l=this.scale;c=this.getImageData(j),f=a("<figure/>").addClass(i.figureClass);if(c.title||c.caption)$figcaption=a("<figcaption/>").addClass(i.figcaptionClass).appendTo(f),c.title&&(g=a("<div />").addClass(i.titleClass).html(c.title).appendTo($figcaption)),c.caption&&(h=a("<div />").addClass(i.captionClass).html(c.caption).appendTo($figcaption));return d=this.loadImage(c.src).css({position:"absolute",left:"50%",top:"50%",visibility:"hidden"}).trigger("create.cfgal").load(function(){var b=a(this),c=l([b.width(),b.height()],[k.width(),k.height()]);f.css({width:c[0],height:c[1],display:"none"}),b.css({width:c[0],height:c[1],"margin-left":-1*(c[0]/2),"margin-top":-1*(c[1]/2),visibility:"visible"}).trigger("loaded.cfgal")}),d.prependTo(f),f.appendTo(k),j.data("cfgalExpanded",f),f},preloadNeighbors:function(a){var b=[1,2,-1],c=this.$thumbs.length-1,d,e;for(d=b.length-1;d>=0;d--)e=a+b[d],e>=0&&e<=c&&!this.getImage(e)&&this.createImage(e)},loadImage:function(b){var c=new Image,d;return c.src=b,c.alt="",a(c)},scale:function(a,b){var c,d=function(d){var e,f;return d?(e=0,f=1):(e=1,f=0),c=b[e]/a[e],a[e]=b[e],a[f]=Math.ceil(a[f]*c),a};return a[0]>b[0]?d(!0):a[1]>b[1]?d(!1):a},parseUrl:function(a){return function(b,c,d){a.href=b,c={};for(d in a)typeof a[d]=="string"&&(c[d]=a[d]);return c}}(document.createElement("a"))},a.fn.cfgallery=e,a.fn.cfShimLinkHash=function(){var b=e.helpers;this.length>0&&this.filter("a").each(function(){var c=a(this),d=b.parseUrl(c.attr("href")),e=b.makeHashToken(d.hash.replace("#",""));c.attr("href",d.href.replace(d.hash,e))})}}(jQuery,window)